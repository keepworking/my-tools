<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>현금영수증 소득공제 계산기</title>
  <style>
    :root { --bg:#0b0f14; --card:#121826; --text:#e6edf3; --muted:#9fb0c0; --line:#223044; --accent:#4da3ff; }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 24px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, #142038 0%, var(--bg) 60%);
      color: var(--text);
    }
    .wrap { max-width: 860px; margin: 0 auto; }
    header h1 { margin: 0 0 8px; font-size: 22px; }
    header p { margin: 0 0 18px; color: var(--muted); line-height: 1.5; }

    .grid { display: grid; gap: 14px; grid-template-columns: 1fr; }
    @media (min-width: 840px) { .grid { grid-template-columns: 1fr 1fr; } }

    .card {
      background: rgba(18,24,38,.92);
      border: 1px solid rgba(34,48,68,.9);
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .row { display: flex; align-items: baseline; justify-content: space-between; gap: 12px; }
    .label { font-weight: 700; }
    .value {
      font-variant-numeric: tabular-nums;
      font-size: 14px;
      color: var(--muted);
      white-space: nowrap;
    }

    .control { margin-top: 12px; display: grid; gap: 10px; }
    .inputs { display: grid; grid-template-columns: 1fr 180px; gap: 10px; align-items: center; }
    input[type="range"] { width: 100%; accent-color: var(--accent); }
    input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: #0c1220;
      color: var(--text);
      font-size: 14px;
      font-variant-numeric: tabular-nums;
      outline: none;
    }
    input[type="number"]:focus { border-color: rgba(77,163,255,.7); box-shadow: 0 0 0 3px rgba(77,163,255,.15); }

    .result h2 { margin: 0 0 10px; font-size: 16px; }
    .big {
      font-size: 30px;
      font-weight: 800;
      letter-spacing: -0.02em;
      font-variant-numeric: tabular-nums;
    }
    .kv {
      margin-top: 10px;
      border-top: 1px dashed rgba(34,48,68,.9);
      padding-top: 10px;
      display: grid; gap: 8px;
    }
    .kv div { display: flex; justify-content: space-between; gap: 12px; color: var(--muted); font-size: 14px; }
    .kv b { color: var(--text); font-weight: 700; }

    .pill {
      display: inline-flex; gap: 8px; align-items: center;
      padding: 8px 10px; border-radius: 999px;
      background: rgba(77,163,255,.12);
      border: 1px solid rgba(77,163,255,.25);
      color: #cfe6ff;
      font-size: 12px;
    }
    .note { margin-top: 10px; color: var(--muted); font-size: 12px; line-height: 1.5; }
    .btns { display:flex; gap:10px; margin-top: 12px; flex-wrap: wrap; }
    button {
      cursor: pointer;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: #0c1220;
      color: var(--text);
      font-weight: 700;
    }
    button:hover { border-color: rgba(77,163,255,.7); }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>현금영수증 소득공제 계산기</h1>
      <p>
        총급여와 현금영수증 사용금액만 입력해서 소득공제 금액을 계산합니다.
        (단순화 모델: 25% 초과분 × 30%, 기본 한도 250/300만원)
      </p>
    </header>

    <div class="grid">
      <section class="card">
        <div class="row">
          <div class="label">총급여(총 소득액)</div>
          <div class="value" id="incomePretty">-</div>
        </div>
        <div class="control">
          <div class="inputs">
            <input id="incomeRange" type="range" min="0" max="200000000" step="100000" value="40000000" />
            <input id="incomeNum" type="number" min="0" max="200000000" step="100000" value="40000000" />
          </div>
          <div class="pill">권장 범위: 0 ~ 2억 (10만원 단위)</div>
        </div>

        <div style="height:12px"></div>

        <div class="row">
          <div class="label">현금영수증 사용금액</div>
          <div class="value" id="cashPretty">-</div>
        </div>
        <div class="control">
          <div class="inputs">
            <input id="cashRange" type="range" min="0" max="50000000" step="10000" value="12000000" />
            <input id="cashNum" type="number" min="0" max="50000000" step="10000" value="12000000" />
          </div>
          <div class="pill">권장 범위: 0 ~ 5천만 (1만원 단위)</div>
        </div>

        <div class="btns">
          <button id="resetBtn" type="button">초기값으로</button>
          <button id="maxBtn" type="button">예시: 한도까지 채우기</button>
        </div>

        <div class="note">
          * 실제 연말정산은 신용카드/체크카드 합산, 전통시장·대중교통·문화비 추가한도 등 변수로 결과가 달라질 수 있습니다.
        </div>
      </section>

      <section class="card result">
        <h2>계산 결과</h2>
        <div class="big" id="deductionPretty">-</div>
        <div class="kv">
          <div><span>공제 시작 기준 (총급여 × 25%)</span><b id="thresholdPretty">-</b></div>
          <div><span>공제대상 사용액 (현금영수증 - 기준, 0 미만이면 0)</span><b id="basePretty">-</b></div>
          <div><span>공제율</span><b id="ratePretty">30%</b></div>
          <div><span>기본 한도</span><b id="limitPretty">-</b></div>
          <div><span>한도 적용 전 공제금액</span><b id="rawPretty">-</b></div>
        </div>
        <div class="note" id="hintNote"></div>
      </section>
    </div>
  </div>

  <script>
    (function () {
      const fmt = new Intl.NumberFormat("ko-KR");
      const money = (n) => fmt.format(Math.round(n)) + "원";

      const incomeRange = document.getElementById("incomeRange");
      const incomeNum   = document.getElementById("incomeNum");
      const cashRange   = document.getElementById("cashRange");
      const cashNum     = document.getElementById("cashNum");

      const incomePretty = document.getElementById("incomePretty");
      const cashPretty = document.getElementById("cashPretty");

      const deductionPretty = document.getElementById("deductionPretty");
      const thresholdPretty = document.getElementById("thresholdPretty");
      const basePretty = document.getElementById("basePretty");
      const limitPretty = document.getElementById("limitPretty");
      const rawPretty = document.getElementById("rawPretty");
      const hintNote = document.getElementById("hintNote");

      const resetBtn = document.getElementById("resetBtn");
      const maxBtn = document.getElementById("maxBtn");

      // 규칙(단순화)
      const RATE = 0.30;
      const THRESHOLD_RATE = 0.25;
      const LIMIT_UNDER_70M = 3_000_000;
      const LIMIT_OVER_70M  = 2_500_000;

      function clamp(v, min, max) {
        if (Number.isNaN(v)) return min;
        return Math.min(max, Math.max(min, v));
      }

      function syncPair(fromEl, toEl) {
        toEl.value = fromEl.value;
      }

      function readValues() {
        const income = clamp(parseInt(incomeNum.value, 10), 0, 200000000);
        const cash   = clamp(parseInt(cashNum.value, 10),   0,  50000000);
        return { income, cash };
      }

      function calc(income, cash) {
        const threshold = income * THRESHOLD_RATE;
        const base = Math.max(0, cash - threshold);
        const raw = base * RATE;

        const limit = (income <= 70_000_000) ? LIMIT_UNDER_70M : LIMIT_OVER_70M;
        const deduction = Math.min(raw, limit);

        return { threshold, base, raw, limit, deduction };
      }

      function render() {
        const { income, cash } = readValues();
        const { threshold, base, raw, limit, deduction } = calc(income, cash);

        incomePretty.textContent = money(income);
        cashPretty.textContent   = money(cash);

        thresholdPretty.textContent = money(threshold);
        basePretty.textContent      = money(base);
        rawPretty.textContent       = money(raw);
        limitPretty.textContent     = money(limit);
        deductionPretty.textContent = money(deduction);

        if (cash <= threshold) {
          hintNote.textContent = "현금영수증 사용액이 총급여의 25% 기준을 넘지 않아서 공제금액이 0원입니다.";
        } else if (raw > limit) {
          hintNote.textContent = "한도(기본 한도)에 걸려서 공제금액이 제한되었습니다.";
        } else {
          hintNote.textContent = "한도 내에서 계산되었습니다.";
        }
      }

      function wireSync(rangeEl, numEl, min, max) {
        rangeEl.addEventListener("input", () => {
          syncPair(rangeEl, numEl);
          render();
        });
        numEl.addEventListener("input", () => {
          const v = clamp(parseInt(numEl.value, 10), min, max);
          if (!Number.isNaN(v)) numEl.value = v;
          syncPair(numEl, rangeEl);
          render();
        });
        numEl.addEventListener("blur", () => {
          // 빈 값 방지
          if (numEl.value === "" || Number.isNaN(parseInt(numEl.value, 10))) {
            numEl.value = rangeEl.value;
          }
          render();
        });
      }

      wireSync(incomeRange, incomeNum, 0, 200000000);
      wireSync(cashRange, cashNum, 0, 50000000);

      resetBtn.addEventListener("click", () => {
        incomeRange.value = incomeNum.value = 40000000;
        cashRange.value = cashNum.value = 12000000;
        render();
      });

      // "한도까지 채우기" 예시: (한도 / 0.3) 만큼의 공제대상 사용액이 필요.
      // 필요 현금영수증 = 기준(25%) + (한도/0.3)
      maxBtn.addEventListener("click", () => {
        const income = 40_000_000;
        const limit = (income <= 70_000_000) ? LIMIT_UNDER_70M : LIMIT_OVER_70M;
        const threshold = income * THRESHOLD_RATE;
        const neededBase = limit / RATE;
        const neededCash = Math.round(threshold + neededBase);

        incomeRange.value = incomeNum.value = income;
        cashRange.value = cashNum.value = clamp(neededCash, 0, 50000000);
        render();
      });

      // 초기 렌더
      render();
    })();
  </script>
</body>
</html>

